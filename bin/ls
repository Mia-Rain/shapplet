#!/bin/sh
# shellcheck disable=SC2059,SC2046,SC2015
loop(){
  IFS=""
  d="${A%*}"; # remove leading /'s
  printf '%s\n' $(for i in ${1}; do i=${i##$d}; printf "$i  "; done)
}
case "$#" in
  0)
    A="./"; loop "./*";;
  *)
    set -- "$@"; i="$#" # backwards loop setup to match coreutils ls
    # also allows checking if last arg
    while [ "$i" -gt 0 ]; do
      eval "A=\${$i}"
      [ -e "$A" ] && {
        [ -f "$A" ] && {
          [ "$#" -gt 1 ] && { A="$A  "; }
          printf '%s\n' "$A"
          [ ! $i -eq 1 ] && { echo; }; :
        } || {
          [ "$#" -gt 1 ] && { printf '%s:\n' "$A"; loop "${A%/}/*"; } || {
            loop "${A%/}/*"
          }
            [ ! $i -eq 1 ] && { echo; }
        :;}
      } || { echo "${0##*/}: cannot access '$1': No such file or directory"; exit 1; }
    : $((i-=1))
    done
  ;;
esac
