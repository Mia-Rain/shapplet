#!/bin/sh
# shellcheck disable=SC2015,SC2166
LANG=C # incase someone tries to use grep on a binary

rcase() {
  while read -r p || [ -n "$p" ] ; do
    case "$p" in
      *"${1}"*)
        [ "$2" != "-q" ] && { IFS=""; printf "%s\\n" "$p"; } || { exit 0; }
      ;;
    esac    
  done <&0
  exit 1
}
case "$#" in
  3)
    [ -e "$2" -a "$3" = "-q" ] && { rcase "$1" "-q" < "$2"; } || {
      exit 1
    }
  ;;
  *)
    [ -e "$2" ] && { rcase "$1" < "$2"; } || {
      rcase "${1:?grep requires an argument}" "${2:+-q}" || exit 1
    }
  ;;
esac
